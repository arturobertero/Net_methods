rownames(fit_mgm$pairwise$wadj) = names(att)
## Centrality
cent_mgm = centralityPlot(fit_mgm$pairwise$wadj, scale = "raw", orderBy = "Strength") +
theme(
axis.text.y = element_text(size = 13),
axis.text.x = element_text(size = 13)
)
ggsave(here("Output", "Fig_mgm_b.jpg"), cent_mgm,
height = 8, width = 12)
## Centrality
cent_mgm = centralityPlot(fit_mgm$pairwise$wadj, scale = "raw", orderBy = "Strength") +
theme(
axis.text.y = element_text(size = 13),
axis.text.x = element_text(size = 13),
strip.text   = element_text(size = 18, face = "bold")
)
ggsave(here("Output", "Fig_mgm_b.jpg"), cent_mgm,
height = 8, width = 12)
#Libraries
library(pacman)
p_load(tidyverse, here, ggcorrplot, patchwork, ggplot2, qgraph, magick,
corclass, ggpubr, nnet, sjPlot, scales, EGAnet, mgm)
#Options
rm(list = ls())
options(scipen = 99)
#Data
data = readRDS(here("Input", "anes_imputed.RDS"))
#Attitudes df
att = data %>% select(Abortion:Lib_cons)
#Names of attitudes
att_vars <- c(
"Abortion", "Black", "Law_order", "Gov_services",
"Defense", "Insurance", "Environment", "Lib_cons"
)
## Corr matrix
# Corr
corr = round(cor(att), 2)
p.mat <- cor_pmat(att)
# Plot
corr_plot = ggcorrplot(
corr, method = "square", hc.order = T, type = "lower",
outline.color = "white", lab = T, insig = "blank"
) +
ggtitle("Correlation Matrix") +
theme(
legend.position = "none",
plot.title = element_text(hjust = 0.5, face = "bold")
)
corr_plot
ggsave(here("Output", "cor", "corr_plot.jpg"), corr_plot,
width = 12, height = 8, dpi = 600)
# Constraint
# Split data by political interest
pol_int_low  <- data %>% filter(Pol_int %in% 1:3) # Low = 1,2,3
pol_int_high <- data %>% filter(Pol_int %in% 4:5)
# function to compute mean absolute off-diagonal correlation
mean_abs_cor <- function(df, vars) {
sub <- df %>% select(all_of(vars))
# correlation matrix with pairwise deletion (does n t matter if u work with imputed data)
cm  <- cor(sub, use = "pairwise.complete.obs")
# take off-diagonal elements only
off_diag <- cm[upper.tri(cm)]
mean(abs(off_diag), na.rm = TRUE)
}
# Bootstrap mean correlational strength for each group
set.seed(123)
B <- 1000
boot_strength <- function(df, vars, B = 1000) {
n <- nrow(df)
map_dbl(1:B, ~ {
idx <- sample.int(n, size = n, replace = TRUE)
mean_abs_cor(df[idx, , drop = FALSE], vars)
})
}
boot_low  <- boot_strength(pol_int_low,  att_vars, B)
boot_high <- boot_strength(pol_int_high, att_vars, B)
# Put bootstrap results into a long data frame for plotting
boot_df <- bind_rows(
tibble(group = "Low political interest",  mean_abs_r = boot_low),
tibble(group = "High political interest", mean_abs_r = boot_high)
)
# Compute bootstrap CIs
ci_summary <- boot_df %>%
group_by(group) %>%
summarise(
est   = mean(mean_abs_r),
lower = quantile(mean_abs_r, 0.025),
upper = quantile(mean_abs_r, 0.975),
.groups = "drop"
)
# Colors (two colors for the inner violins)
mycols <- c("Low political interest" = "#40B0A6",
"High political interest" = "#E1BE6A")
#values
ci_summary
# violin plot
violin <- ggplot(boot_df, aes(x = factor(group), y = mean_abs_r, fill = group)) +
geom_violin(width = 1.0, alpha = 0.8, color = "black", trim = FALSE) +
scale_fill_manual(values = mycols) +
coord_cartesian(ylim = c(0.25, 0.65)) +
labs(
y = "Constraint",
x = NULL,
) +
scale_y_continuous(
limits = c(0.25, 0.65),
breaks = seq(0.25, 0.65, by = 0.05)
) +
ggtitle("Belief constraint") +
theme(
legend.position = "none",
plot.title = element_text(hjust = 0.5, face = "bold"),
axis.text.x = element_text(size = 13)
)
violin
ggsave(here("Output", "cor", "violin.jpg"), violin,
width = 12, height = 8, dpi = 600)
## Network
# Inspect the corr matrix
corr
# Open a JPG device
jpeg(here("Output", "bna", "Fig2_a.jpg"),
width = 12, height = 8, units = "in", res = 600)
# Generate the qgraph plot
qgraph(
corr, layout = 'spring', labels = colnames(corr),
edge.color = "black",  color = "#40B0A6",
borders = TRUE, vsize = 9.5, esize = 7, label.cex = 1,
label.scale = F)
dev.off()
## Centrality
cent = centralityPlot(corr, scale = "raw", orderBy = "Strength") +
theme(
axis.text.y = element_text(size = 13),
axis.text.x = element_text(size = 13),
strip.text   = element_text(size = 18, face = "bold")
)
ggsave(here("Output", "bna", "Fig2_b.jpg"), cent,
height = 8, width = 12)
#CCA applied to attitudes
cca_att <- cca(att, filter.significance = TRUE, filter.value = 0.01,
zero.action = c("ownclass"))
# cca_att <- cca(att, filter.significance = TRUE, filter.value = 0.10,
#                  zero.action = c("ownclass"))
# Preliminary plots
plot(cca_att, 1)
plot(cca_att, 2)
plot(cca_att, 3)
plot(cca_att, 4)
plot(cca_att, 5)
# save cor mat
cca1 = cca_att[["modules"]][[1]][["cormat"]]
cca2 = cca_att[["modules"]][[3]][["cormat"]]
cca3 = cca_att[["modules"]][[4]][["cormat"]]
cca4 = cca_att[["modules"]][[5]][["cormat"]]
# Add membership data to data
data_cca = data
data_cca$cca = cca_att$membership
#Create dat_cca* obj for p mat
dat_cca1 = data_cca %>% filter(cca == 1) %>% select(Abortion:Lib_cons)
dat_cca2 = data_cca %>% filter(cca == 3) %>% select(Abortion:Lib_cons)
dat_cca3 = data_cca %>% filter(cca == 4) %>% select(Abortion:Lib_cons)
dat_cca4 = data_cca %>% filter(cca == 5) %>% select(Abortion:Lib_cons)
# do p mat
pmat1 <- cor_pmat(dat_cca1, use = "pairwise.complete.obs", method = "pearson")
pmat2 <- cor_pmat(dat_cca2, use = "pairwise.complete.obs", method = "pearson")
pmat3 <- cor_pmat(dat_cca3, use = "pairwise.complete.obs", method = "pearson")
pmat4 <- cor_pmat(dat_cca4, use = "pairwise.complete.obs", method = "pearson")
## Matrix plot
# labels for the four modules (adapt as needed)
cca_groups_names <- c("Group 1 (n=1775)", "Group 2 (n=849)", "Group 3 (n=1710)", "Group 4 (n=1133")
# CCA1
plot_cca1 <- ggcorrplot(
cca1,
method = "square",
type   = "lower",
outline.color = "white",
lab    = TRUE,
lab_size = 3,
p.mat = pmat1,
insig = "blank"
) +
ggtitle(cca_groups_names[1]) +
theme(
legend.position = "none",
plot.title = element_text(size = 17, face = "bold", hjust = 0.5),
plot.margin = margin(2, 2, 2, 2, "mm")
)
# CCA2
plot_cca2 <- ggcorrplot(
cca2,
method = "square",
type   = "lower",
outline.color = "white",
lab    = TRUE,
lab_size = 3,
p.mat = pmat2,
insig = "blank"
) +
ggtitle(cca_groups_names[2]) +
theme(
legend.position = "none",
plot.title = element_text(size = 17, face = "bold", hjust = 0.5),
plot.margin = margin(2, 2, 2, 2, "mm")
)
# CCA3
plot_cca3 <- ggcorrplot(
cca3,
method = "square",
type   = "lower",
outline.color = "white",
lab    = TRUE,
lab_size = 3,
p.mat = pmat3,
insig = "blank"
) +
ggtitle(cca_groups_names[3]) +
theme(
legend.position = "none",
plot.title = element_text(size = 17, face = "bold", hjust = 0.5),
plot.margin = margin(2, 2, 2, 2, "mm")
)
# CCA4
plot_cca4 <- ggcorrplot(
cca4,
method = "square",
type   = "lower",
outline.color = "white",
lab    = TRUE,
lab_size = 3,
p.mat = pmat4,
insig = "blank"
) +
ggtitle(cca_groups_names[4]) +
theme(
legend.position = "none",
plot.title = element_text(size = 17, face = "bold", hjust = 0.5),
plot.margin = margin(2, 2, 2, 2, "mm")
)
plot_cca_list <- list(plot_cca1, plot_cca2, plot_cca3, plot_cca4)
g_plot_cca <- ggarrange(
plotlist = plot_cca_list,
ncol = 2,
nrow = 2
)
ggsave(
here("Output", "cca", "CCA_corrs.jpeg"),
g_plot_cca,
dpi = 600,
height = 12,
width  = 12
)
##Network plot
# Same group titles as in the ggcorrplot figure
cca_groups_names <- c(
"Group 1 (n=1775)",
"Group 2 (n=849)",
"Group 3 (n=1710)",
"Group 4 (n=1133)"
)
# Open device for multi-panel figure
jpeg(
here("Output", "cca", "CCA_networks.jpeg"),
height  = 3508,   # adjust as you like
width   = 3508,
quality = 100
)
# Common layout for all four networks
L <- averageLayout(cca1, cca2, cca3, cca4, layout = "spring")
# Matrix layout: 2 rows, 2 columns
lmat <- matrix(1:4, 2, 2, byrow = TRUE)
layout(lmat, widths = c(1, 1), heights = c(1, 1))
# 1: Group 1 [put layout = L for standardized layout]
set.seed(1)
g1 <- qgraph(
cca1, layout = "spring",
labels = colnames(cca1),
color = "#40B0A6",
borders = TRUE, vsize = 13, esize = 9, label.cex = 3.5,
label.scale = F, title = cca_groups_names[1], title.cex = 7,
theme = "colorblind"
)
# 2: Group 2
g2 <- qgraph(
cca2, layout = "spring",
labels = colnames(cca1),
color = "#40B0A6",
borders = TRUE, vsize = 13, esize = 9, label.cex = 3.5,
label.scale = F, title = cca_groups_names[2], title.cex = 7,
theme = "colorblind"
)
# 3: Group 3
g3 <- qgraph(
cca3, layout = "spring",
labels = colnames(cca1),
color = "#40B0A6",
borders = TRUE, vsize = 13, esize = 9, label.cex = 3.5,
label.scale = F, title = cca_groups_names[3], title.cex = 7,
theme = "colorblind"
)
# 4: Group 4
g4 <- qgraph(
cca4, layout = "spring",
labels = colnames(cca1),
color = "#40B0A6",
borders = TRUE, vsize = 13, esize = 9, label.cex = 3.5,
label.scale = F, title = cca_groups_names[4], title.cex = 7,
theme = "colorblind"
)
# Close device and save
dev.off()
set.seed(123)
boot_cca1 <- boot_strength(dat_cca1, att_vars, B)
boot_cca2 <- boot_strength(dat_cca2, att_vars, B)
boot_cca3 <- boot_strength(dat_cca3, att_vars, B)
boot_cca4 <- boot_strength(dat_cca4, att_vars, B)
boot_cca_df <- bind_rows(
tibble(group = "Group 1", mean_abs_r = boot_cca1),
tibble(group = "Group 2", mean_abs_r = boot_cca2),
tibble(group = "Group 3", mean_abs_r = boot_cca3),
tibble(group = "Group 4", mean_abs_r = boot_cca4)
)
# CIs
ci_cca <- boot_cca_df %>%
group_by(group) %>%
summarise(
est   = mean(mean_abs_r),
lower = quantile(mean_abs_r, 0.025),
upper = quantile(mean_abs_r, 0.975),
.groups = "drop"
)
ci_cca
#Violin plot with 4 groups
mycols_cca <- c(
"Group 1" = "#40B0A6",
"Group 2" = "#E1BE6A",
"Group 3" = "#D35E60",
"Group 4" = "#8073AC"
)
violin_cca <- ggplot(boot_cca_df,
aes(x = factor(group,
levels = c("Group 1", "Group 2", "Group 3", "Group 4")),
y = mean_abs_r,
fill = group)) +
geom_violin(width = 1.0, alpha = 0.8, color = "black", trim = FALSE) +
scale_fill_manual(values = mycols_cca) +
coord_cartesian(ylim = c(0.25, 0.70)) +
scale_y_continuous(
limits = c(0.25, 0.75),
breaks = seq(0.25, 0.75, by = 0.05)
) +
labs(
x = NULL,
y = "Constraint"
) +
ggtitle("Belief constraint by CCA group") +
theme(
legend.position = "none",
plot.title = element_text(hjust = 0.5, face = "bold"),
axis.text.x = element_text(size = 13)
)
violin_cca
ggsave(here("Output", "cca", "cca_violins.jpg"), violin_cca,
width = 12, height = 8, dpi = 600)
# Select fewer cols
data_cca_reg = data_cca %>% select(Gender:cca)
#Recode cca as unordered factor
data_cca_reg <- data_cca_reg %>%
mutate(
cca_rec = case_when(
cca == 1 ~ "Group 1",
cca == 2 ~ NA_character_,
cca == 3 ~ "Group 2",
cca == 4 ~ "Group 3",
cca == 5 ~ "Group 4",
TRUE    ~ NA_character_
),
cca_rec = factor(
cca_rec,
levels = c("Group 1", "Group 2", "Group 3", "Group 4")  # explicit order, but unordered factor
)
)
# Recode 2 vars as unorderd factor to accomodate nnet logic
data_cca_reg = data_cca_reg %>%
mutate(
Education = factor(Education, ordered = FALSE),
Party_id  = factor(Party_id,  ordered = FALSE)
)
# Drop NAs on cca_rec (i.e., those with zero variance)
data_cca_reg_mod <- data_cca_reg %>%
filter(!is.na(cca_rec))
#Model
mod_cca <- multinom(
cca_rec ~ Gender + Pol_int + Education + Party_id,
data = data_cca_reg_mod
)
#Tab
tab_model(mod_cca, p.style = "stars",
title = "", show.intercept = FALSE,
show.loglik = TRUE, show.aic = TRUE,
file = here("Output", "cca", "cca_reg.doc"))
# model plot
p_mod <- plot_model(
mod_cca,
vline.color = "red",
show.values = TRUE,
value.offset = .3,
axis.lim = c(0.10, 1.70)   # <-- truncate OR axis here
)
# save
ggsave(
filename = here("Output", "cca", "cca_reg_plot.jpeg"),
plot = p_mod,
dpi = 600,
height = 8,
width = 10
)
# Make a tidy frequency + proportion table
plot_df <- data_cca_reg %>%
filter(!is.na(cca_rec)) %>%
count(cca_rec, Party_id) %>%
group_by(cca_rec) %>%
mutate(prop = n / sum(n)) %>%
ungroup()
# Order Party_id sensibly (Dem → Ind → Rep)
plot_df <- plot_df %>%
mutate(
Party_id = factor(
Party_id,
levels = c(
"Strong Dem", "Weak Dem", "Lean Dem",
"Pure Ind",
"Lean Rep", "Weak Rep", "Strong Rep"
)
),
cca_rec = factor(
cca_rec,
levels = c("Group 1", "Group 2", "Group 3", "Group 4")
)
)
# Faceted lollipop plot
p_cca_party <- ggplot(plot_df, aes(x = prop, y = Party_id)) +
# lollipop stems
geom_segment(aes(x = 0, xend = prop, y = Party_id, yend = Party_id),
color = "#E1BE6A", linewidth = 0.6) +
# points
geom_point(size = 2.5, color = "#40B0A6") +
facet_wrap(~ cca_rec, ncol = 2) +
scale_x_continuous(labels = percent_format(accuracy = 1)) +
labs(
x = "Share within CCA group",
y = "Party identification",
title = "Party identification profile across CCA groups"
) +
theme_minimal(base_size = 13) +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
strip.text = element_text(face = "bold"),
panel.grid.major.y = element_blank()
)
p_cca_party
ggsave(
here("Output", "cca", "cca_party_lollipop.jpeg"),
p_cca_party,
dpi = 600,
height = 8,
width  = 10
)
# EGA
ega_att = EGA(att)
# mgm
att_mat = as.matrix(att)
p <- ncol(att_mat)
# All variables are numeric
type  <- rep("g", p)        # "g" = Gaussian
level <- rep(1, p)        # number of categories for each variable, 1 for g var
fit_mgm <- mgm(
data   = att_mat,
type   = type,
level  = level,
k      = 2,        # pairwise
lambda.sel = "EBIC",  # or "CV"
lambdaGam  = 0.25,    # EBIC gamma
ruleReg    = "AND"    # AND-rule for edge selection
)
#Predictability
pred_mgm <- predict(
object = fit_mgm,
data   = att_mat
)
# Open a JPG device
jpeg(here("Output", "mgm", "Fig_mgm.jpg"),
width = 12, height = 8, units = "in", res = 600)
# Generate the qgraph plot
qgraph(
fit_mgm$pairwise$wadj, layout = 'spring', labels = colnames(corr),
edge.color = "blue",  color = "#40B0A6",
pieColor = rep('#E1BE6A',p),
borders = TRUE, vsize = 9.9, esize = 8, label.cex = 0.9,
label.scale = F, pie = pred_mgm[["errors"]][["R2"]])
dev.off()
colnames(fit_mgm$pairwise$wadj) = names(att)
rownames(fit_mgm$pairwise$wadj) = names(att)
## Centrality
cent_mgm = centralityPlot(fit_mgm$pairwise$wadj, scale = "raw", orderBy = "Strength") +
theme(
axis.text.y = element_text(size = 13),
axis.text.x = element_text(size = 13),
strip.text   = element_text(size = 18, face = "bold")
)
ggsave(here("Output", "mgm", "Fig_mgm_b.jpg"), cent_mgm,
height = 8, width = 12)
